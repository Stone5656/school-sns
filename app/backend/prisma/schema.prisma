// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

enum UserRole {
  ADMIN
  STUDENT
  TEACHER
}

enum ArtifactStatus {
  DRAFT
  PUBLISHED
}

model Users {
  id String @id @default(uuid(4))
  userName String
  email String @unique
  passwordHash String
  role UserRole @default(STUDENT)
  bio String?
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  worldMembers WorldMembers[]

  userFollowerRelationships UserRelationships[] @relation("follower")
  userFolloweeRelationships UserRelationships[] @relation("followee")

  artifacts Artifacts[]

  scraps Scraps[]

  comments Comments[]

  assets Assets[]

  mentions Mentions[]
}

model UserRelationships {
  id String @id @default(uuid(4))
  follower Users @relation("follower", fields: [followerId], references: [id])
  followerId String
  followee Users @relation("followee", fields: [followeeId], references: [id])
  followeeId String
  createdAt DateTime @default(now())
}

model Worlds {
  id String @id @default(uuid(4))
  name String
  description String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  worldMembers WorldMembers[]
}

model WorldMembers {
  id String @id @default(uuid(4))
  world Worlds @relation(fields: [worldId], references: [id])
  worldId String
  user Users @relation(fields: [userId], references: [id])
  userId String
  joinedAt DateTime @default(now())
}

model Artifacts {
  id String @id @default(uuid(4))
  user Users @relation(fields: [userId], references: [id])
  userId String
  title String
  body String
  summaryByAI String
  status ArtifactStatus @default(DRAFT)
  publishedAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  comments Comments[]

  tagArticles TagArticles[]

  mentions Mentions[]
}

model Scraps {
  id String @id @default(uuid(4))
  parent Scraps? @relation("ScrapToParent", fields: [parentId], references: [id])
  parentId String?
  user Users @relation(fields: [userId], references: [id])
  userId String
  title String
  body String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  scraps Scraps[] @relation("ScrapToParent")

  tagScraps TagScraps[]
}

model Comments {
  id String @id @default(uuid(4))
  user Users @relation(fields: [userId], references: [id])
  userId String
  artifact Artifacts @relation(fields: [artifactId], references: [id])
  artifactId String
  body String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tags {
  id String @id @default(uuid(4))
  name String @unique
  slug String @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tagArticles TagArticles[]

  tagScraps TagScraps[]
}

model TagArticles {
  id String @id @default(uuid(4))
  artifact Artifacts @relation(fields: [artifactId], references: [id])
  artifactId String
  tag Tags @relation(fields: [tagId], references: [id])
  tagId String
  createdAt DateTime @default(now())
}

model Assets {
  id String @id @default(uuid(4))
  user Users @relation(fields: [userId], references: [id])
  userId String
  url String
  fileType String
  originName String
  sizeBytes BigInt
  createdAt DateTime @default(now())
}

model Mentions {
  id String @id @default(uuid(4))
  artifact Artifacts @relation(fields: [artifactId], references: [id])
  artifactId String
  user Users @relation(fields: [mentionedUserId], references: [id])
  mentionedUserId String
  createdAt DateTime @default(now())
}

model TagScraps {
  id String @id @default(uuid(4))
  scrap Scraps @relation(fields: [scrapId], references: [id])
  scrapId String
  tag Tags @relation(fields: [tagId], references: [id])
  tagId String
  createdAt DateTime @default(now())
}
